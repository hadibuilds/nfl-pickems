pip install -r requirements.txt && \
rm -rf frontend/dist/ backend/static/assets/ staticfiles/ backend/templates/index.html && \
cd frontend && npm install && npx vite build && cd .. && \
mkdir -p backend/static/assets/ backend/templates/ && \
cp -R frontend/dist/assets/* backend/static/assets/ && \
cp frontend/dist/index.html backend/templates/index.html && \
sed -i '1s;^;{% load static %}\n;' backend/templates/index.html && \
sed -i -E "s|/static/assets/([^\"]+\.js)|{% static 'assets/\1' %}|g" backend/templates/index.html && \
sed -i -E "s|/static/assets/([^\"]+\.css)|{% static 'assets/\1' %}|g" backend/templates/index.html && \
python backend/manage.py collectstatic --noinput --settings=nfl_pickems.settings.prod && \
python backend/manage.py makemigrations --settings=nfl_pickems.settings.prod && \
python backend/manage.py migrate --settings=nfl_pickems.settings.prod && \
python backend/manage.py populate_nfl_games --limit 0 --settings=nfl_pickems.settings.prod
